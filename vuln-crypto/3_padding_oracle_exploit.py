#!/usr/bin/env python3
"""
Padding Oracle κ³µκ²©
κ³µκ²© λ°©λ²•: ν¨λ”© μ¤λ¥ λ©”μ‹μ§€λ¥Ό μ΄μ©ν•μ—¬ μ•”νΈλ¬Έμ„ λ³µνΈν™”

=============================================================================
π“ λ°°κ²½ μ§€μ‹: ν¨λ”©(Padding)μ΄ λ­”κ°€μ”?
=============================================================================

AES κ°™μ€ λΈ”λ΅ μ•”νΈλ” 16λ°”μ΄νΈμ”© μ²λ¦¬ν•©λ‹λ‹¤.
κ·Όλ° λ©”μ‹μ§€κ°€ λ”± 16λ°”μ΄νΈ λ°°μκ°€ μ•„λ‹λ©΄ μ–΄λ–»κ² ν• κΉμ”?

μμ‹:
  "Hello" = 5λ°”μ΄νΈ
  AESλ” 16λ°”μ΄νΈκ°€ ν•„μ”ν•¨
  β†’ λ‚λ¨Έμ§€ 11λ°”μ΄νΈλ¥Ό λ­”κ°€λ΅ μ±„μ›μ•Ό ν•¨ = "ν¨λ”©"

PKCS#7 ν¨λ”© κ·μΉ™:
  - λ¶€μ΅±ν• λ°”μ΄νΈ μλ¥Ό κ·Έ μ«μλ΅ μ±„μ›€
  - 11λ°”μ΄νΈ λ¶€μ΅± β†’ 0x0Bλ¥Ό 11κ° μ¶”κ°€
  - 1λ°”μ΄νΈ λ¶€μ΅± β†’ 0x01μ„ 1κ° μ¶”κ°€
  - λ”± λ§μΌλ©΄? β†’ 0x10μ„ 16κ° μ¶”κ°€ (ν• λΈ”λ΅ μ „μ²΄κ°€ ν¨λ”©)

  μ: "Hello" (5λ°”μ΄νΈ) + ν¨λ”©
      H  e  l  l  o  0B 0B 0B 0B 0B 0B 0B 0B 0B 0B 0B
      |---- 5 -----|--------------- 11 ---------------|

λ³µνΈν™”ν•  λ•:
  1. λ§μ§€λ§‰ λ°”μ΄νΈλ¥Ό μ½μ (μ: 0x0B = 11)
  2. λ§μ§€λ§‰ 11λ°”μ΄νΈκ°€ λ¨λ‘ 0x0BμΈμ§€ ν™•μΈ
  3. λ§μΌλ©΄ μ„±κ³µ, ν‹€λ¦¬λ©΄ "ν¨λ”© μ¤λ¥!"

=============================================================================
π’΅ Padding Oracleμ΄ λ­”κ°€μ”?
=============================================================================

"Oracle"μ€ "μ§λ¬Έν•λ©΄ λ€λ‹µν•΄μ£Όλ” κ²ƒ"μ„ μλ―Έν•©λ‹λ‹¤.

Padding Oracle = μ„λ²„κ°€ "ν¨λ”©μ΄ λ§λ”μ§€/ν‹€λ¦°μ§€" μ•λ ¤μ£Όλ” κ²ƒ

μ·¨μ•½ν• μ„λ²„μ λ°μ‘:
  - ν¨λ”©μ΄ λ§μ β†’ "Success" λλ” μ •μƒ μ‘λ‹µ
  - ν¨λ”©μ΄ ν‹€λ¦Ό β†’ "Padding Error" λλ” 500 μ—λ¬

μ΄ μ°¨μ΄μ μ„ μ΄μ©ν•΄μ„ κ³µκ²©μκ°€ μ•”νΈλ¬Έμ„ λ³µνΈν™”ν•  μ μμµλ‹λ‹¤!

=============================================================================
"""

import base64
from Crypto.Cipher import AES
from Crypto.Util.Padding import pad
from Crypto.Random import get_random_bytes

SECRET_KEY = b'SECRET_KEY_16BYT'

def decrypt_vulnerable(ciphertext_b64: str) -> tuple:
    """
    μ·¨μ•½ν• λ³µνΈν™” ν•¨μ

    λ¬Έμ μ : ν¨λ”© μ¤λ¥μ™€ λ‹¤λ¥Έ μ¤λ¥λ¥Ό κµ¬λ¶„ν•΄μ„ λ°ν™ν•¨!
    β†’ κ³µκ²©μκ°€ μ΄ μ°¨μ΄λ¥Ό μ΄μ© κ°€λ¥
    """
    try:
        data = base64.b64decode(ciphertext_b64)
        iv = data[:16]
        ciphertext = data[16:]

        cipher = AES.new(SECRET_KEY, AES.MODE_CBC, iv)
        padded_plaintext = cipher.decrypt(ciphertext)

        try:
            from Crypto.Util.Padding import unpad
            plaintext = unpad(padded_plaintext, AES.block_size)
            return (True, "Success", plaintext.decode())
        except ValueError:
            # β† μ΄κ² μ·¨μ•½μ ! ν¨λ”© μ¤λ¥λ¥Ό κµ¬λ¶„ν•΄μ„ μ•λ ¤μ¤
            return (False, "Padding Error", None)
    except Exception as e:
        return (False, f"Decryption Error: {str(e)}", None)

def padding_oracle(ciphertext_b64: str) -> bool:
    """
    ν¨λ”© μ¤λΌν΄: ν¨λ”©μ΄ μ¬λ°”λ¥Έμ§€ ν™•μΈ
    True: ν¨λ”©μ΄ μ¬λ°”λ¦„
    False: ν¨λ”©μ΄ μλ»λ¨
    """
    success, message, _ = decrypt_vulnerable(ciphertext_b64)
    return message != "Padding Error"

def xor_bytes(a: bytes, b: bytes) -> bytes:
    """λ‘ λ°”μ΄νΈμ—΄μ„ XOR"""
    return bytes(x ^ y for x, y in zip(a, b))

def demonstrate_vulnerability():
    """
    μ·¨μ•½μ  μ‹μ—°

    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚ 1λ‹¨κ³„: μ·¨μ•½μ  ν™•μΈ - μ„λ²„κ°€ ν¨λ”© μ¤λ¥λ¥Ό κµ¬λ¶„ν•΄μ„ μ•λ ¤μ£Όλ”κ°€?     β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    """
    print("=" * 70)
    print("1λ‹¨κ³„: μ·¨μ•½μ  ν™•μΈ - μ„λ²„ λ°μ‘ μ°¨μ΄ κ΄€μ°°")
    print("=" * 70 + "\n")

    # β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    # STEP 1: μ·¨μ•½μ  μ›λ¦¬ μ„¤λ…
    # β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    print("[STEP 1] μ·¨μ•½μ  μ›λ¦¬")
    print("    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”")
    print("    β”‚ μ•μ „ν• μ„λ²„:                                          β”‚")
    print("    β”‚   - λ¨λ“  λ³µνΈν™” μ‹¤ν¨ β†’ λ™μΌν• μ—λ¬ λ©”μ‹μ§€              β”‚")
    print("    β”‚   - μ: 'λ³µνΈν™” μ‹¤ν¨' (μ›μΈ κµ¬λ¶„ λ¶κ°€)                 β”‚")
    print("    β”‚                                                        β”‚")
    print("    β”‚ μ·¨μ•½ν• μ„λ²„:                                          β”‚")
    print("    β”‚   - ν¨λ”© μ¤λ¥ β†’ 'Padding Error'                       β”‚")
    print("    β”‚   - λ‹¤λ¥Έ μ¤λ¥ β†’ 'Decryption Error' λλ” μ„±κ³µ          β”‚")
    print("    β”‚   β†’ μ΄ μ°¨μ΄λ¥Ό μ΄μ©ν•΄ κ³µκ²© κ°€λ¥!                       β”‚")
    print("    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”\n")

    # β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    # STEP 2: μ •μƒμ μΈ μ•”νΈλ¬Έ ν…μ¤νΈ
    # β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    print("[STEP 2] μ •μƒ μ•”νΈλ¬Έ vs μ΅°μ‘λ μ•”νΈλ¬Έ λΉ„κµ")
    print("-" * 60)

    # μ •μƒ λ°μ΄ν„° μƒμ„±
    iv = get_random_bytes(16)
    cipher = AES.new(SECRET_KEY, AES.MODE_CBC, iv)
    padded = pad(b"Normal data", AES.block_size)
    ct = cipher.encrypt(padded)
    normal_token = base64.b64encode(iv + ct).decode()

    print(f"\n    2-1. μ •μƒ μ•”νΈλ¬Έ μ „μ†΅")
    print(f"         μ›λ³Έ λ©”μ‹μ§€: 'Normal data'")
    print(f"         μ•”νΈλ¬Έ: {normal_token[:40]}...")
    result1 = decrypt_vulnerable(normal_token)
    print(f"         μ„λ²„ μ‘λ‹µ: {result1[1]}")

    # ν¨λ”© μ¤λ¥ μ λ° (λ§μ§€λ§‰ λ°”μ΄νΈ λ³€μ΅°)
    ct_bad_padding = ct[:-1] + bytes([ct[-1] ^ 0x01])  # XORλ΅ 1λΉ„νΈ λ³€κ²½
    bad_token = base64.b64encode(iv + ct_bad_padding).decode()

    print(f"\n    2-2. ν¨λ”©μ΄ κΉ¨μ§„ μ•”νΈλ¬Έ μ „μ†΅")
    print(f"         λ§μ§€λ§‰ λ°”μ΄νΈλ¥Ό XOR 0x01λ΅ λ³€μ΅°")
    print(f"         μ•”νΈλ¬Έ: {bad_token[:40]}...")
    result2 = decrypt_vulnerable(bad_token)
    print(f"         μ„λ²„ μ‘λ‹µ: {result2[1]}")

    # β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    # STEP 3: μ·¨μ•½μ  λ¶„μ„
    # β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    print(f"\n[STEP 3] μ·¨μ•½μ  λ¶„μ„")
    print("-" * 60)

    print(f"\n    μ„λ²„ μ‘λ‹µ λΉ„κµ:")
    print(f"      μ •μƒ μ•”νΈλ¬Έ    β†’ '{result1[1]}'")
    print(f"      μ΅°μ‘λ μ•”νΈλ¬Έ  β†’ '{result2[1]}'")

    if result1[1] != result2[1]:
        print(f"\n    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”")
        print(f"    β”‚ μ·¨μ•½μ  λ°κ²¬!                                          β”‚")
        print(f"    β”‚                                                        β”‚")
        print(f"    β”‚ μ„λ²„κ°€ λ‹¤λ¥Έ μ¤λ¥ λ©”μ‹μ§€λ¥Ό λ°ν™ν•©λ‹λ‹¤!                  β”‚")
        print(f"    β”‚ κ³µκ²©μλ” μ΄ μ°¨μ΄λ¥Ό μ΄μ©ν•μ—¬:                          β”‚")
        print(f"    β”‚   - λ°”μ΄νΈλ¥Ό ν•λ‚μ”© μ¶”μΈ΅                               β”‚")
        print(f"    β”‚   - μ¬λ°”λ¥Έ ν¨λ”©μ΄ λλ” κ°’μ„ μ°Ύμ                       β”‚")
        print(f"    β”‚   - μ΄λ¥Ό ν†µν•΄ ν‰λ¬Έμ„ λ³µκµ¬!                             β”‚")
        print(f"    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”")

def explain_attack_principle():
    """
    κ³µκ²© μ›λ¦¬ μƒμ„Έ μ„¤λ…

    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚ 2λ‹¨κ³„: κ³µκ²© μ›λ¦¬ μ΄ν•΄ - μ–΄λ–»κ² ν• λ°”μ΄νΈμ”© μ•μ•„λ‚΄λ”κ°€?           β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    """
    print("\n" + "=" * 70)
    print("2λ‹¨κ³„: κ³µκ²© μ›λ¦¬ μƒμ„Έ μ„¤λ…")
    print("=" * 70 + "\n")

    # β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    # STEP 1: CBC λ³µνΈν™” κ³Όμ • λ³µμµ
    # β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    print("[STEP 1] CBC λ³µνΈν™” κ³Όμ • λ³µμµ")
    print("-" * 60)

    print("""
    CBC λ¨λ“μ—μ„ λ³µνΈν™”λ” μ΄λ ‡κ² λ©λ‹λ‹¤:

        β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
        β”‚  μ•”νΈλ¬Έ C   β”‚
        β””β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”
               β”‚
               β–Ό
        β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
        β”‚ AES λ³µνΈν™”  β”‚  β† ν‚¤ μ‚¬μ©
        β””β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”
               β”‚
               β–Ό
        β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
        β”‚ μ¤‘κ°„κ°’ I    β”‚  β† μ΄ κ°’μ„ μ•μ•„λ‚΄λ” κ² λ©ν‘!
        β””β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”
               β”‚
               β• β†β”€β”€β”€β”€β”€β”€ IV (λλ” μ΄μ „ μ•”νΈλ¬Έ λΈ”λ΅)
               β”‚
               β–Ό
        β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
        β”‚  ν‰λ¬Έ P     β”‚
        β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

    ν•µμ‹¬ κ³µμ‹:
        P = I β• IV

    λ”°λΌμ„:
        I = P β• IV  (μ¤‘κ°„κ°’μ„ μ•λ©΄ ν‰λ¬Έμ„ μ• μ μλ‹¤!)
    """)

    # β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    # STEP 2: κ³µκ²© μ•„μ΄λ””μ–΄
    # β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    print("[STEP 2] κ³µκ²© μ•„μ΄λ””μ–΄")
    print("-" * 60)

    print("""
    κ³µκ²©μμ μ „λµ:

    1. IVλ¥Ό μ΅°μ‘ν•΄μ„ λ³µνΈν™”λ ν‰λ¬Έμ ν¨λ”©μ„ λ°”κΏ€ μ μμ

    2. λ§μ§€λ§‰ λ°”μ΄νΈλ¶€ν„° κ³µκ²©:
       - IVμ λ§μ§€λ§‰ λ°”μ΄νΈλ¥Ό 0~255κΉμ§€ μ‹λ„
       - μ–΄λ–¤ κ°’μ—μ„ "ν¨λ”© μ¤λ¥"κ°€ μ• λ‚λ©΄?
       - β†’ κ·Έ κ°’μ΄ μ¬λ°”λ¥Έ ν¨λ”©(0x01)μ„ λ§λ“¤μ–΄λƒ„!

    3. μ¤‘κ°„κ°’ κ³„μ‚°:
       - μ¬λ°”λ¥Έ ν¨λ”© = 0x01
       - IV_guess β• I = 0x01
       - λ”°λΌμ„: I = IV_guess β• 0x01

    4. ν‰λ¬Έ λ³µκµ¬:
       - P = I β• IV_original
       - μ¤‘κ°„κ°’ Iλ¥Ό μ•μ•μΌλ‹ μ›λ ν‰λ¬Έ Pλ¥Ό κ³„μ‚°!

    κ·Έλ¦ΌμΌλ΅ λ³΄λ©΄:
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚                                                            β”‚
    β”‚  κ³µκ²©μκ°€ μ‹λ„:  IV' = [??][??]...[??][00]                β”‚
    β”‚                                    β†“                      β”‚
    β”‚  λ³µνΈν™” κ²°κ³Ό:    P' = I β• IV' = [...][I[15] β• 00]        β”‚
    β”‚                                                            β”‚
    β”‚  00λ¶€ν„° FFκΉμ§€ μ‹λ„...                                    β”‚
    β”‚                                                            β”‚
    β”‚  IV' = [??][??]...[??][3F]μΌ λ• ν¨λ”© OK!                  β”‚
    β”‚                    β†“                                      β”‚
    β”‚  P'μ λ§μ§€λ§‰ = I[15] β• 3F = 0x01 (μ¬λ°”λ¥Έ ν¨λ”©)           β”‚
    β”‚                    β†“                                      β”‚
    β”‚  λ”°λΌμ„ I[15] = 3F β• 01 = 0x3E                           β”‚
    β”‚                    β†“                                      β”‚
    β”‚  μ›λ ν‰λ¬Έ P[15] = I[15] β• IV[15] = 0x3E β• IV[15]        β”‚
    β”‚                                                            β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    """)

    # β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    # STEP 3: λ‘ λ²μ§Έ λ°”μ΄νΈ κ³µκ²©
    # β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    print("[STEP 3] λ‘ λ²μ§Έ λ°”μ΄νΈλ” μ–΄λ–»κ²?")
    print("-" * 60)

    print("""
    μ΄λ―Έ I[15]λ¥Ό μ•μ•μΌλ‹, μ΄μ  I[14]λ¥Ό μ•μ•„λ‚΄μ•Ό ν•¨!

    λ©ν‘: ν¨λ”©μ΄ 0x02 0x02κ°€ λκ² λ§λ“¤κΈ°

    λ°©λ²•:
    1. IV'[15] = I[15] β• 0x02  (λ§μ§€λ§‰ λ°”μ΄νΈκ°€ 0x02κ°€ λλ„λ΅)
    2. IV'[14]λ¥Ό 0~255κΉμ§€ μ‹λ„
    3. ν¨λ”© μ¤λ¥κ°€ μ• λ‚λ©΄ β†’ P'[14] = 0x02
    4. I[14] = IV'[14] β• 0x02

    μ΄λ ‡κ² λ’¤μ—μ„λ¶€ν„° ν• λ°”μ΄νΈμ”© μ•μ•„λƒ„!
    μ „μ²΄ 16λ°”μ΄νΈλ¥Ό λ¨λ‘ μ•μ•„λ‚΄λ©΄ β†’ λΈ”λ΅ μ „μ²΄ λ³µνΈν™” μ™„λ£!
    """)

def decrypt_block_with_oracle(iv: bytes, ciphertext_block: bytes) -> bytes:
    """
    Padding Oracleμ„ μ΄μ©ν• λΈ”λ΅ λ³µνΈν™”

    CBC λ¨λ“: P = D(C) β• IV
    ν¨λ”© μ¤λΌν΄μ„ μ΄μ©ν•μ—¬ D(C)λ¥Ό λ³µκµ¬ν•κ³ , IVμ™€ XORν•μ—¬ ν‰λ¬Έ λ³µκµ¬
    """
    block_size = 16
    intermediate = bytearray(block_size)  # μ¤‘κ°„κ°’ (D(C) κ²°κ³Ό)

    print("\n    λΈ”λ΅ λ³µνΈν™” μ‹μ‘...")
    print("    (λ’¤μ—μ„λ¶€ν„° ν• λ°”μ΄νΈμ”© κ³µκ²©)\n")

    # λ’¤μ—μ„λ¶€ν„° ν• λ°”μ΄νΈμ”© κ³µκ²©
    for pad_value in range(1, block_size + 1):
        target_index = block_size - pad_value
        print(f"    [{pad_value:2d}/16] μ„μΉ {target_index} κ³µκ²© μ¤‘ (λ©ν‘ ν¨λ”©: 0x{pad_value:02x})...", end=" ")

        # κ³µκ²©μ© IV μƒμ„±
        attack_iv = bytearray(block_size)

        # μ΄λ―Έ μ•μ•„λ‚Έ λ°”μ΄νΈλ“¤μ„ ν„μ¬ ν¨λ”© κ°’μ— λ§κ² μ„¤μ •
        for i in range(target_index + 1, block_size):
            attack_iv[i] = intermediate[i] ^ pad_value

        # ν„μ¬ λ°”μ΄νΈ μ°ΎκΈ°
        found = False
        for byte_value in range(256):
            attack_iv[target_index] = byte_value

            # ν…μ¤νΈ
            test_data = bytes(attack_iv) + ciphertext_block
            test_b64 = base64.b64encode(test_data).decode()

            if padding_oracle(test_b64):
                # μ¬λ°”λ¥Έ ν¨λ”©μ„ μ°Ύμ!
                # μ¶”κ°€ κ²€μ¦ (μ²« λ°”μ΄νΈμΌ λ• 0x02 0x02λ„ κ°€λ¥ν•λ―€λ΅)
                if pad_value == 1:
                    # μ΄μ „ λ°”μ΄νΈλ¥Ό λ³€κ²½ν•΄μ„ μ—¬μ „ν μ ν¨ν•μ§€ ν™•μΈ
                    attack_iv[target_index - 1] ^= 1
                    test_data2 = bytes(attack_iv) + ciphertext_block
                    test_b642 = base64.b64encode(test_data2).decode()
                    if not padding_oracle(test_b642):
                        attack_iv[target_index - 1] ^= 1  # λ³µμ›
                        continue

                intermediate[target_index] = byte_value ^ pad_value
                print(f"λ°κ²¬! I[{target_index}] = 0x{intermediate[target_index]:02x}")
                found = True
                break

        if not found:
            print("μ‹¤ν¨")

    # ν‰λ¬Έ λ³µκµ¬: P = I β• IV
    decrypted = xor_bytes(intermediate, iv)
    return bytes(decrypted)

def padding_oracle_attack_demo():
    """
    Padding Oracle κ³µκ²© λ°λ¨

    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚ 3λ‹¨κ³„: μ‹¤μ  κ³µκ²© μν–‰ - μ•”νΈλ¬Έμ„ λ³µνΈν™”ν•΄λ³΄μ!                   β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    """
    print("\n" + "=" * 70)
    print("3λ‹¨κ³„: μ‹¤μ  κ³µκ²© μν–‰")
    print("=" * 70 + "\n")

    # β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    # κ³µκ²© μ‹λ‚λ¦¬μ¤ μ„¤λ…
    # β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    print("[κ³µκ²© μ‹λ‚λ¦¬μ¤]")
    print("    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”")
    print("    β”‚ μƒν™©:                                                  β”‚")
    print("    β”‚   - μ„λ²„κ°€ μ•”νΈν™”λ μ„Έμ… ν† ν°μ„ μ‚¬μ©                   β”‚")
    print("    β”‚   - κ³µκ²©μκ°€ μ•”νΈλ¬Έμ„ κ°€λ΅μ±” (λ‚΄μ©μ€ λ¨λ¦„)             β”‚")
    print("    β”‚   - μ„λ²„κ°€ ν¨λ”© μ¤λ¥λ¥Ό κµ¬λ¶„ν•΄μ„ μ•λ ¤μ¤                 β”‚")
    print("    β”‚                                                        β”‚")
    print("    β”‚ λ©ν‘:                                                  β”‚")
    print("    β”‚   β†’ μ•”νΈλ¬Έλ§μΌλ΅ μ›λ ν‰λ¬Έμ„ λ³µκµ¬!                     β”‚")
    print("    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”\n")

    # β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    # STEP 1: κ³µκ²© λ€μƒ μƒμ„±
    # β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    print("[STEP 1] κ³µκ²© λ€μƒ μ•”νΈλ¬Έ μƒμ„± (μ‹λ®¬λ μ΄μ…)")
    print("-" * 60)

    plaintext = "SECRET_MESSAGE!!"
    iv = get_random_bytes(16)
    cipher = AES.new(SECRET_KEY, AES.MODE_CBC, iv)
    padded = pad(plaintext.encode(), AES.block_size)
    ciphertext = cipher.encrypt(padded)

    print(f"\n    μ›λ³Έ ν‰λ¬Έ: '{plaintext}' (κ³µκ²©μλ” μ΄κ±Έ λ¨λ¦„!)")
    print(f"    IV:        {iv.hex()}")
    print(f"    μ•”νΈλ¬Έ:    {ciphertext.hex()}")

    # β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    # STEP 2: κ³µκ²© μν–‰
    # β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    print(f"\n[STEP 2] Padding Oracle κ³µκ²© μν–‰")
    print("-" * 60)

    print("\n    κ³µκ²©μκ°€ μ•„λ” κ²ƒ: IV + μ•”νΈλ¬Έ (λ‚΄μ©μ€ λ¨λ¦„)")
    print("    κ³µκ²©μκ°€ ν•  κ²ƒ: μ„λ²„μ— μ΅°μ‘λ μ•”νΈλ¬Έμ„ λ³΄λ‚΄λ©° λ°μ‘ κ΄€μ°°\n")

    try:
        # μ²« λ²μ§Έ λΈ”λ΅ κ³µκ²©
        recovered = decrypt_block_with_oracle(iv, ciphertext[:16])

        # β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
        # STEP 3: κ²°κ³Ό ν™•μΈ
        # β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
        print(f"\n[STEP 3] κ²°κ³Ό ν™•μΈ")
        print("-" * 60)

        print(f"\n    λ³µκµ¬λ μ›μ‹ λ°μ΄ν„°: {recovered.hex()}")

        # ν¨λ”© μ κ±°
        try:
            from Crypto.Util.Padding import unpad
            recovered_unpadded = unpad(recovered, AES.block_size)
            recovered_text = recovered_unpadded.decode()

            print(f"    ν¨λ”© μ κ±° ν›„: '{recovered_text}'")
            print(f"    μ›λ ν‰λ¬Έ:    '{plaintext}'")

            if recovered_text == plaintext:
                print(f"\n    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”")
                print(f"    β”‚ κ³µκ²© μ„±κ³µ!                                             β”‚")
                print(f"    β”‚                                                        β”‚")
                print(f"    β”‚ ν‚¤ μ—†μ΄ μ•”νΈλ¬Έμ„ λ³µνΈν™”ν–μµλ‹λ‹¤!                       β”‚")
                print(f"    β”‚                                                        β”‚")
                print(f"    β”‚ μ™ μ΄κ² κ°€λ¥ν–λ‚?                                      β”‚")
                print(f"    β”‚   β†’ μ„λ²„κ°€ ν¨λ”© μ¤λ¥λ¥Ό κµ¬λ¶„ν•΄μ„ μ•λ ¤μ¤                 β”‚")
                print(f"    β”‚   β†’ 256κ°€μ§€ μ‹λ„ Γ— 16λ°”μ΄νΈ = μµλ€ 4,096λ² μ”μ²­        β”‚")
                print(f"    β”‚   β†’ μ΄ μ •λ„λ©΄ λ‡ μ΄ λ§μ— ν• λΈ”λ΅ λ³µνΈν™” κ°€λ¥!          β”‚")
                print(f"    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”")
        except Exception as e:
            print(f"    ν¨λ”© μ κ±° μ‹¤ν¨: {e}")
            print(f"    λ³µκµ¬λ μ›μ‹ λ°μ΄ν„°: {recovered}")

    except Exception as e:
        print(f"\n    κ³µκ²© μ¤‘ μ¤λ¥: {e}")

def show_defense_methods():
    """
    λ°©μ–΄ λ°©λ²• μ„¤λ…

    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚ 4λ‹¨κ³„: λ°©μ–΄ λ°©λ²• - μ–΄λ–»κ² λ§‰μ„ μ μμ„κΉ?                        β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    """
    print("\n" + "=" * 70)
    print("4λ‹¨κ³„: λ°©μ–΄ λ°©λ²•")
    print("=" * 70 + "\n")

    print("""
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚ 1. λ™μΌν• μ¤λ¥ λ©”μ‹μ§€ λ°ν™                                     β”‚
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
    β”‚                                                                β”‚
    β”‚   # μ·¨μ•½ν• μ½”λ“                                               β”‚
    β”‚   except PaddingError:                                        β”‚
    β”‚       return "Padding Error"    β† ν¨λ”© μ¤λ¥ κµ¬λ¶„λ¨!           β”‚
    β”‚   except OtherError:                                          β”‚
    β”‚       return "Other Error"                                    β”‚
    β”‚                                                                β”‚
    β”‚   # μ•μ „ν• μ½”λ“                                               β”‚
    β”‚   except Exception:                                           β”‚
    β”‚       return "Decryption Failed"  β† λ¨λ“  μ¤λ¥κ°€ λ™μΌ!         β”‚
    β”‚                                                                β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚ 2. μΈμ¦λ μ•”νΈν™”(Authenticated Encryption) μ‚¬μ©                β”‚
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
    β”‚                                                                β”‚
    β”‚   AES-GCM, AES-CCM κ°™μ€ λ¨λ“ μ‚¬μ©                             β”‚
    β”‚                                                                β”‚
    β”‚   νΉμ§•:                                                        β”‚
    β”‚   - μ•”νΈν™” + λ¬΄κ²°μ„± κ²€μ¦μ„ λ™μ‹μ—                             β”‚
    β”‚   - μ•”νΈλ¬Έμ΄ λ³€μ΅°λλ©΄ λ³µνΈν™” μ „μ— κ±°λ¶€                        β”‚
    β”‚   - ν¨λ”© μ¤λΌν΄ κ³µκ²© μμ²΄κ°€ λ¶κ°€λ¥!                           β”‚
    β”‚                                                                β”‚
    β”‚   μμ‹ μ½”λ“:                                                   β”‚
    β”‚   cipher = AES.new(key, AES.MODE_GCM)                         β”‚
    β”‚   ciphertext, tag = cipher.encrypt_and_digest(data)           β”‚
    β”‚                                                                β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚ 3. νƒ€μ΄λ° κ³µκ²© λ°©μ§€                                            β”‚
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
    β”‚                                                                β”‚
    β”‚   μ¤λ¥ λ©”μ‹μ§€κ°€ κ°™μ•„λ„ μ‘λ‹µ μ‹κ°„μ΄ λ‹¤λ¥΄λ©΄ κµ¬λ¶„ κ°€λ¥!           β”‚
    β”‚                                                                β”‚
    β”‚   - ν¨λ”© κ²€μ¦ μ‹¤ν¨ β†’ λΉ λ¥΄κ² μ¤λ¥ λ°ν™                        β”‚
    β”‚   - λ‹¤λ¥Έ μ²λ¦¬ ν›„ μ‹¤ν¨ β†’ λλ¦¬κ² μ¤λ¥ λ°ν™                     β”‚
    β”‚                                                                β”‚
    β”‚   ν•΄κ²°: λ¨λ“  κ²½λ΅μ μ²λ¦¬ μ‹κ°„μ„ λ™μΌν•κ²!                      β”‚
    β”‚                                                                β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚ 4. Rate Limiting (μ”μ²­ μ ν•)                                   β”‚
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
    β”‚                                                                β”‚
    β”‚   κ³µκ²©μ—λ” μμ² λ²μ μ”μ²­μ΄ ν•„μ”                               β”‚
    β”‚   β†’ λΉ„μ •μƒμ μΌλ΅ λ§μ€ μ”μ²­μ„ νƒμ§€ν•κ³  μ°¨λ‹¨                    β”‚
    β”‚                                                                β”‚
    β”‚   μ: 1λ¶„μ— 100λ² μ΄μƒ λ³µνΈν™” μ‹¤ν¨ μ‹ IP μ°¨λ‹¨                  β”‚
    β”‚                                                                β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    """)

if __name__ == "__main__":
    print("β•”" + "β•" * 68 + "β•—")
    print("β•‘" + "Padding Oracle κ³µκ²© Exploit λ°λ¨".center(68) + "β•‘")
    print("β•‘" + "(κ³ λ“±ν•™μƒλ„ μ΄ν•΄ν•  μ μλ” μΉμ ν• μ„¤λ…)".center(60) + "        β•‘")
    print("β•" + "β•" * 68 + "β•\n")

    # 1. μ·¨μ•½μ  μ‹μ—°
    demonstrate_vulnerability()

    # 2. κ³µκ²© μ›λ¦¬ μ„¤λ…
    explain_attack_principle()

    # 3. μ‹¤μ  κ³µκ²© λ°λ¨
    padding_oracle_attack_demo()

    # 4. λ°©μ–΄ λ°©λ²•
    show_defense_methods()

    print("\n" + "=" * 70)
    print("ν•µμ‹¬ μ •λ¦¬")
    print("=" * 70)
    print("""
    Padding Oracle κ³µκ²©μ΄λ€?
    - μ„λ²„κ°€ "ν¨λ”© μ¤λ¥"λ¥Ό κµ¬λ¶„ν•΄μ„ μ•λ ¤μ£Όλ” κ²ƒμ„ μ•…μ©
    - 256κ°€μ§€ μ‹λ„ Γ— 16λ°”μ΄νΈ = μµλ€ 4,096λ² μ”μ²­μΌλ΅ ν• λΈ”λ΅ λ³µνΈν™”
    - ν‚¤λ¥Ό λ¨λ¥΄κ³ λ„ μ•”νΈλ¬Έμ„ λ³µνΈν™”ν•  μ μμ!

    μ™ μ„ν—ν•κ°€?
    - μ„Έμ… ν† ν°, μΏ ν‚¤, API ν‚¤ λ“±μ„ νƒμ·¨ κ°€λ¥
    - κ³Όκ±°μ— λ§μ€ μ‹¤μ  μ‹μ¤ν…μ΄ μ΄ κ³µκ²©μ— μ·¨μ•½ν–μ
    - ASP.NET, JavaServer Faces λ“± μ λ… ν”„λ μ„μ›ν¬λ„ μν–¥λ°›μ

    λ°©μ–΄ λ°©λ²•:
    1. λ¨λ“  μ¤λ¥μ— λ™μΌν• λ©”μ‹μ§€ λ°ν™
    2. AES-GCM κ°™μ€ μΈμ¦λ μ•”νΈν™” μ‚¬μ© (κ¶μ¥!)
    3. νƒ€μ΄λ° κ³µκ²©λ„ ν•¨κ» λ°©μ–΄
    4. μ”μ²­ μ μ ν• (Rate Limiting)
    """)
    print("=" * 70)
